<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>区域产业图谱控制台 - 苏州产业园区运营平台</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    
    <link rel="stylesheet" href="../../css/style.css">

    <style>
        /* --- 继承自 industry-map.html 的核心样式 --- */
        body { background-color: #f8fafc; color: #1e293b; overflow: hidden; font-family: 'Inter', 'PingFang SC', sans-serif; }
        
        /* 玻璃拟态面板 */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.8); 
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05); 
            border-radius: 1rem; 
        }
        
        /* 3D GIS 视口 */
        .gis-viewport { 
            position: absolute; 
            inset: 0; 
            z-index: 0;
            background: #eef2f7; 
            /* 科技感网格背景 */
            background-image: linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px); 
            background-size: 60px 60px; 
            perspective: 1200px; 
            overflow: hidden;
        }
        
        /* 图层叠加控制 */
        .map-layer { position: absolute; inset: 0; transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        #layer-heat { z-index: 5; } 
        #layer-industry { z-index: 10; } 
        #layer-facility { z-index: 20; } 

        /* 3D 建筑体样式 */
        .building-3d { 
            position: absolute; 
            background: linear-gradient(135deg, #cbd5e1 0%, #f1f5f9 100%); 
            border: 1px solid #94a3b8; 
            /* 核心 2.5D 倾斜角度 */
            transform: rotateX(45deg) rotateZ(-45deg); 
            box-shadow: 10px 10px 25px rgba(0,0,0,0.1); 
            transition: all 0.5s ease; 
            cursor: pointer;
        }
        .building-3d:hover {
            transform: rotateX(45deg) rotateZ(-45deg) translateZ(20px);
            box-shadow: 20px 20px 50px rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            z-index: 50;
        }

        /* 配套设施标签样式 */
        .facility-tag { 
            position: absolute; 
            padding: 6px 12px; 
            background: rgba(255,255,255,0.95); 
            border-radius: 30px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            font-size: 11px; 
            font-weight: bold; 
            color: #475569;
            display: flex; align-items: center; gap: 6px; 
            border: 1px solid #e2e8f0; 
            transition: all 0.4s ease; 
            white-space: nowrap; 
        }
        .facility-tag:hover {
            transform: scale(1.1) translateY(-5px);
            z-index: 60;
            color: #2563eb;
            border-color: #3b82f6;
        }

        /* 热力图光斑 */
        .heatmap-cell { 
            position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0; transition: opacity 1s ease; pointer-events: none; mix-blend-mode: multiply;
        }
        
        /* 切换按钮样式 */
        .tab-btn { transition: all 0.3s; }
        .tab-btn.active { background: #3b82f6; color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .tab-btn:not(.active):hover { background: #f1f5f9; color: #3b82f6; }

        /* 隐藏滚动条 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="font-sans text-slate-600">

    <div id="navbar-placeholder" class="relative z-50"></div>

    <div class="fixed top-24 left-1/2 -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md p-1.5 rounded-full border border-slate-200 flex gap-2 shadow-xl pointer-events-auto transition-transform hover:translate-y-1">
        <button onclick="switchLayer('industry')" id="btn-industry" class="tab-btn active px-5 py-2 rounded-full text-xs font-bold flex items-center gap-2">
            <i class="fa-solid fa-city"></i> 3D产业地图
        </button>
        <button onclick="switchLayer('facility')" id="btn-facility" class="tab-btn px-5 py-2 rounded-full text-xs font-bold text-slate-500 flex items-center gap-2">
            <i class="fa-solid fa-mug-hot"></i> 配套设施分布
        </button>
        <button onclick="switchLayer('heat')" id="btn-heat" class="tab-btn px-5 py-2 rounded-full text-xs font-bold text-slate-500 flex items-center gap-2">
            <i class="fa-solid fa-fire text-orange-500"></i> 聚集度热力
        </button>
    </div>

    <aside class="fixed left-6 top-32 bottom-32 w-80 z-30 flex flex-col gap-4 pointer-events-none">
        <div class="glass-panel h-full p-6 flex flex-col pointer-events-auto">
            <h3 class="font-black text-slate-800 mb-4 flex items-center gap-2 border-l-4 border-amber-500 pl-3">
                产业成果与荣誉
            </h3>
            <div class="flex-1 overflow-y-auto space-y-4 no-scrollbar pr-2">
                <div class="p-3 bg-white rounded-xl border border-slate-100 shadow-sm cursor-pointer group">
                    <div class="h-32 bg-slate-100 rounded-lg mb-2 overflow-hidden relative">
                        <img src="https://images.unsplash.com/photo-1555664424-778a1e5e1b48?w=400&q=80" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute bottom-2 left-2 bg-black/60 text-white text-[10px] px-2 py-0.5 rounded backdrop-blur">实物 3D</div>
                    </div>
                    <p class="text-xs font-bold group-hover:text-blue-600 transition-colors">高性能车规级 MCU 芯片</p>
                    <p class="text-[10px] text-slate-400 mt-1">纳芯微电子 · 2024 金奖</p>
                </div>
                
                <div class="p-4 bg-blue-50/50 border border-blue-100 rounded-xl">
                    <p class="text-[10px] text-blue-600 font-bold mb-1">转化成果</p>
                    <p class="text-xs font-bold text-slate-700">基于AI的工业质检视觉算法</p>
                    <div class="flex justify-between items-center mt-2 border-t border-blue-100 pt-2">
                        <span class="text-[10px] text-slate-400">转化率 100%</span>
                        <span class="text-xs font-bold text-blue-700">¥ 250万</span>
                    </div>
                </div>

                <div class="p-4 bg-slate-50 rounded-xl border border-dashed border-slate-300">
                    <p class="text-[10px] text-slate-500 font-bold mb-2">园区资质荣誉</p>
                    <div class="flex flex-wrap gap-2">
                        <span class="text-[10px] bg-white px-2 py-1 rounded shadow-sm border border-slate-200 text-slate-600">国家级高新区</span>
                        <span class="text-[10px] bg-white px-2 py-1 rounded shadow-sm border border-slate-200 text-slate-600">绿色工厂</span>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <aside class="fixed right-6 top-32 bottom-32 w-80 z-30 flex flex-col gap-4 pointer-events-none">
        <div class="glass-panel p-5 flex-1 flex flex-col pointer-events-auto">
            <h3 class="text-sm font-black text-slate-800 mb-2 border-l-4 border-blue-600 pl-3 uppercase">产值统计与分析</h3>
            <div id="chart-output" class="flex-1 w-full min-h-[140px]"></div>
        </div>
        <div class="glass-panel p-5 flex-1 flex flex-col pointer-events-auto">
            <h3 class="text-sm font-black text-slate-800 mb-2 border-l-4 border-emerald-500 pl-3 uppercase">人才结构分布</h3>
            <div id="chart-talent" class="flex-1 w-full min-h-[140px]"></div>
        </div>
    </aside>

    <footer class="fixed bottom-6 left-6 right-6 h-24 z-30 glass-panel p-0 flex items-center gap-0 overflow-hidden pointer-events-auto">
        <div class="w-64 shrink-0 h-full bg-slate-50/50 flex flex-col justify-center px-8 border-r border-slate-200">
            <h3 class="text-lg font-black text-blue-600">科创指数趋势</h3>
            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Innovation Index</p>
        </div>
        <div class="flex-1 h-full px-4 relative">
            <div id="chart-index" class="w-full h-full absolute -top-2"></div>
        </div>
        <div class="w-72 shrink-0 h-full p-4 flex items-center justify-center">
            <div class="w-full h-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl flex items-center px-4 gap-3 shadow-lg shadow-blue-200 cursor-pointer hover:shadow-xl transition-shadow">
                <i class="fa-solid fa-lightbulb animate-bounce"></i>
                <div>
                    <p class="text-[10px] opacity-80 uppercase font-bold">AI 决策建议</p>
                    <p class="text-xs font-bold leading-tight">建议在 B 区扩容公共技术平台资源。</p>
                </div>
            </div>
        </div>
    </footer>

    <main class="gis-viewport">
        <div id="layer-heat" class="map-layer">
            <div class="heatmap-cell" style="top: 25%; left: 30%; width: 450px; height: 450px; background: radial-gradient(circle, rgba(59, 130, 246, 0.6) 0%, transparent 75%);"></div>
            <div class="heatmap-cell" style="top: 45%; left: 50%; width: 500px; height: 500px; background: radial-gradient(circle, rgba(16, 185, 129, 0.5) 0%, transparent 75%);"></div>
            <div class="heatmap-cell" style="top: 10%; left: 15%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(239, 68, 68, 0.3) 0%, transparent 75%);"></div>
            <div class="heatmap-cell" style="top: 70%; left: 10%; width: 250px; height: 250px; background: radial-gradient(circle, rgba(245, 158, 11, 0.3) 0%, transparent 75%);"></div>
        </div>

        <div id="layer-industry" class="map-layer">
            <div class="building-3d" style="top: 35%; left: 35%; width: 50px; height: 130px; background: #3b82f6; border-color: #2563eb;"><div class="absolute -top-7 left-0 text-[10px] font-bold bg-blue-600 text-white px-2 py-0.5 rounded shadow-md whitespace-nowrap z-50">总部大厦 (A1)</div></div>
            <div class="building-3d" style="top: 50%; left: 55%; width: 100px; height: 50px; background: #10b981; border-color: #059669;"><div class="absolute -top-7 left-0 text-[10px] font-bold bg-emerald-500 text-white px-2 py-0.5 rounded shadow-md whitespace-nowrap z-50">P3实验室集群</div></div>
            <div class="building-3d" style="top: 25%; left: 70%; width: 60px; height: 80px; background: #f59e0b; border-color: #d97706;"><div class="absolute -top-7 left-0 text-[10px] font-bold bg-amber-500 text-white px-2 py-0.5 rounded shadow-md whitespace-nowrap z-50">纳米孵化中心</div></div>
            <div class="building-3d" style="top:32%; left:38%; width:30px; height:60px;"></div>
            <div class="building-3d" style="top:42%; left:36%; width:25px; height:90px;"></div>
            <div class="building-3d" style="top:55%; left:58%; width:45px; height:40px;"></div>
            <div class="building-3d" style="top:22%; left:75%; width:35px; height:50px;"></div>
            <div class="building-3d" style="top:65%; left:30%; width:40px; height:50px;"></div>
            <div class="building-3d" style="top:75%; left:60%; width:50px; height:60px;"></div>
            <div class="building-3d" style="top:15%; left:25%; width:25px; height:45px;"></div>
            <div class="building-3d" style="top:5%; left:55%; width:30px; height:30px;"></div>
            <div class="building-3d" style="top:90%; left:10%; width:40px; height:20px;"></div>
            <div class="building-3d" style="top:40%; left:85%; width:35px; height:55px;"></div>
        </div>

        <div id="layer-facility" class="map-layer">
            <div class="facility-tag" style="top: 30%; left: 20%;"><i class="fa-solid fa-server text-red-500"></i> 智算中心</div>
            <div class="facility-tag" style="top: 78%; left: 28%;"><i class="fa-solid fa-charging-station text-emerald-500"></i> 超充站</div>
            <div class="facility-tag" style="top: 65%; left: 72%;"><i class="fa-solid fa-hotel text-indigo-400"></i> 人才公寓</div>
            <div class="facility-tag" style="top: 15%; left: 60%;"><i class="fa-solid fa-tower-broadcast text-blue-500"></i> 5G基站</div>
            <div class="facility-tag" style="top: 85%; left: 55%;"><i class="fa-solid fa-hospital text-pink-400"></i> 医疗中心</div>
            <div class="facility-tag" style="top: 12%; left: 35%;"><i class="fa-solid fa-leaf text-green-500"></i> 中央公园</div>
            <div class="facility-tag" style="top: 55%; left: 10%;"><i class="fa-solid fa-droplet text-cyan-500"></i> 水处理站</div>
            <div class="facility-tag" style="top: 48%; left: 42%;"><i class="fa-solid fa-utensils text-orange-400"></i> 园区食堂</div>
            <div class="facility-tag" style="top: 25%; left: 85%;"><i class="fa-solid fa-bank text-amber-600"></i> 金融驿站</div>
            <div class="facility-tag" style="top: 92%; left: 15%;"><i class="fa-solid fa-bus text-sky-500"></i> 班车起点</div>
            <div class="facility-tag" style="top: 5%; left: 45%;"><i class="fa-solid fa-wifi text-blue-400"></i> WiFi节点</div>
            <div class="facility-tag" style="top: 40%; left: 15%;"><i class="fa-solid fa-coffee text-amber-900"></i> 商务咖啡</div>
            <div class="facility-tag" style="top: 60%; left: 85%;"><i class="fa-solid fa-dumbbell text-purple-500"></i> 健身房</div>
            <div class="facility-tag" style="top: 22%; left: 5%;"><i class="fa-solid fa-box-open text-orange-400"></i> 智慧快递</div>
            <div class="facility-tag" style="top: 8%; left: 80%;"><i class="fa-solid fa-book-open text-blue-400"></i> 共享书库</div>
            <div class="facility-tag" style="top: 35%; left: 55%; border-left: 3px solid #3b82f6;"><i class="fa-solid fa-microchip text-blue-500"></i> 公共中试线</div>
            <div class="facility-tag" style="top: 20%; left: 70%;"><i class="fa-solid fa-flask-vial text-purple-500"></i> 共享实验室</div>
            <div class="facility-tag" style="top: 45%; left: 80%;"><i class="fa-solid fa-copyright text-amber-500"></i> 知识产权中心</div>
            <div class="facility-tag" style="top: 15%; left: 10%;"><i class="fa-solid fa-scale-balanced text-slate-600"></i> 法律服务站</div>
            <div class="facility-tag" style="top: 68%; left: 15%;"><i class="fa-solid fa-cart-shopping text-pink-500"></i> 智慧超市</div>
            <div class="facility-tag" style="top: 58%; left: 45%;"><i class="fa-solid fa-mug-hot text-orange-700"></i> 商务吧</div>
            <div class="facility-tag" style="top: 72%; left: 85%;"><i class="fa-solid fa-child-reaching text-emerald-500"></i> 托育中心</div>
            <div class="facility-tag" style="top: 88%; left: 12%;"><i class="fa-solid fa-shirt text-blue-400"></i> 24H自助洗衣</div>
            <div class="facility-tag" style="top: 52%; left: 88%;"><i class="fa-solid fa-pills text-green-600"></i> 智慧药房</div>

            <div class="facility-tag" style="top: 5%; left: 65%;"><i class="fa-solid fa-wind text-sky-400"></i> 环境监测站</div>
            <div class="facility-tag" style="top: 92%; left: 68%;"><i class="fa-solid fa-bolt-lightning text-yellow-500"></i> 柔性变电站</div>
            <div class="facility-tag" style="top: 40%; left: 48%;"><i class="fa-solid fa-video text-slate-400"></i> AI安防中心</div>
            <div class="facility-tag" style="top: 75%; left: 40%;"><i class="fa-solid fa-bicycle text-green-500"></i> 共享单车点</div>
            <div class="facility-tag" style="top: 8%; left: 55%;"><i class="fa-solid fa-plane-up text-blue-300"></i> 无人机巡检站</div>

            <div class="facility-tag" style="top: 38%; left: 28%; border-left: 3px solid #ef4444;"><i class="fa-solid fa-building-user text-red-500"></i> 一站式服务厅</div>
            <div class="facility-tag" style="top: 82%; left: 75%;"><i class="fa-solid fa-truck-fast text-orange-500"></i> 智慧物流集散</div>
            <div class="facility-tag" style="top: 18%; left: 90%;"><i class="fa-solid fa-print text-slate-500"></i> 图文制作中心</div>
            <div class="facility-tag" style="top: 32%; left: 8%;"><i class="fa-solid fa-handshake text-indigo-500"></i> 共享会议室</div>
            <div class="facility-tag" style="top: 62%; left: 5%;"><i class="fa-solid fa-briefcase text-blue-800"></i> 人才驿站</div>

        </div>
    </main>

    <script src="../../js/components/navbar.js"></script>

    <script>
        let charts = {};

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            // 默认显示产业图层
            switchLayer('industry');
            
            // 监听窗口缩放，重绘图表
            window.addEventListener('resize', () => {
                Object.values(charts).forEach(c => c.resize());
            });
            // 强制触发一次 resize 确保图表填满容器
            setTimeout(() => window.dispatchEvent(new Event('resize')), 200);
        });

        // 图层切换逻辑
        function switchLayer(type) {
            // 1. 按钮状态切换
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active', 'text-white'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.add('text-slate-500'));
            
            const btn = document.getElementById('btn-'+type);
            btn.classList.add('active', 'text-white');
            btn.classList.remove('text-slate-500');

            // 2. 图层可见性控制
            const buildings = document.querySelectorAll('.building-3d');
            const facilities = document.querySelectorAll('.facility-tag');
            const heats = document.querySelectorAll('.heatmap-cell');

            if(type === 'facility') {
                // 配套设施模式：建筑变淡，设施高亮
                buildings.forEach(b => { b.style.opacity = "0.08"; b.style.filter = "grayscale(100%)"; });
                facilities.forEach(f => { f.style.opacity = "1"; f.style.transform = "scale(1)"; });
                heats.forEach(h => h.style.opacity = "0");
            } else if(type === 'heat') {
                // 热力图模式：建筑半透明，隐藏设施
                buildings.forEach(b => { b.style.opacity = "0.4"; b.style.filter = "grayscale(0%)"; });
                facilities.forEach(f => { f.style.opacity = "0"; f.style.transform = "scale(0.8)"; });
                heats.forEach(h => h.style.opacity = "1");
            } else {
                // 默认模式：显示建筑，设施半透明
                buildings.forEach(b => { b.style.opacity = "1"; b.style.filter = "grayscale(0%)"; });
                facilities.forEach(f => { f.style.opacity = "0.6"; f.style.transform = "scale(0.9)"; });
                heats.forEach(h => h.style.opacity = "0");
            }
        }

        // 初始化图表
        function initCharts() {
            const outDom = document.getElementById('chart-output');
            const talentDom = document.getElementById('chart-talent');
            const indexDom = document.getElementById('chart-index');

            if(outDom) {
                charts.output = echarts.init(outDom);
                charts.output.setOption({
                    tooltip: { trigger: 'axis' },
                    grid: { top: '15%', left: '5%', right: '5%', bottom: '10%', containLabel: true },
                    xAxis: { type: 'category', data: ['A区', 'B区', 'C区', 'D区'], axisLabel: { fontSize: 10, color: '#64748b' }, axisLine: {show: false}, axisTick: {show: false} },
                    yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#64748b' }, splitLine: { lineStyle: {type: 'dashed', color: '#e2e8f0'} } },
                    series: [{ data: [280, 180, 95, 42], type: 'bar', barWidth: 16, itemStyle: {color: '#3b82f6', borderRadius: [4,4,0,0]} }]
                });
            }
            if(talentDom) {
                charts.talent = echarts.init(talentDom);
                charts.talent.setOption({
                    tooltip: { trigger: 'item' },
                    series: [{ 
                        type: 'pie', 
                        radius: ['45%', '70%'], 
                        center: ['50%', '50%'],
                        avoidLabelOverlap: false,
                        label: { show: false },
                        data: [
                            {value: 75, name: '工程师', itemStyle: {color: '#3b82f6'}}, 
                            {value: 25, name: '管理人员', itemStyle: {color: '#10b981'}}
                        ] 
                    }]
                });
            }
            if(indexDom) {
                charts.index = echarts.init(indexDom);
                charts.index.setOption({
                    grid: { top: 5, left: 0, right: 0, bottom: 0, containLabel: false },
                    tooltip: { trigger: 'axis' },
                    xAxis: { type: 'category', data: ['20', '21', '22', '23', '24', '25'], boundaryGap: false, show: false },
                    yAxis: { show: false },
                    series: [{ 
                        data: [68, 75, 82, 80, 92, 98], 
                        type: 'line', 
                        smooth: true, 
                        showSymbol: false,
                        lineStyle: { width: 3, color: '#3b82f6' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(59, 130, 246, 0.3)' },
                                { offset: 1, color: 'rgba(59, 130, 246, 0)' }
                            ])
                        }
                    }]
                });
            }
        }
    </script>
</body>
</html>